{"version":3,"sources":["main/core.cljs"],"mappings":"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","names":["js/main","js/main.core","js/main.core.state","main.core/state","reagent.core.atom","main.core/point-r","p__28915","map__28916","cljs.core/--destructure-map","cljs.core.get","main.core/draw-point","ctx","x","y","highlighted?","G__28917","js/Math.PI","main.core/draw-canvas","map__28918","cljs.core/deref","vec__28919","cljs.core.nth","arc","start","control1","control2","end","G__28922","main.core/main-view","main.core/->xy","canvas-rect","event","main.core/in-vicinity?","v","js/Math.abs","main.core/on-mousedown","vec__28923","map__28926","point-path","hit","cljs.core.reduce","p__28927","map__28928","path","point","cljs.core/reduced","cljs.core.prn","cljs.core.swap_BANG_","cljs.core/assoc-in","cljs.core/assoc","main.core/on-mousemove","temp__5753__auto__","vec__28929","main.core/on-mouseup","cljs.core/dissoc","main.core/setup-canvas","canvas-element","js/document.getElementById","dpr","or__4253__auto__","js/window.devicePixelRatio","cljs.core.partial","main.core/start","reagent.dom.render","main.core/run"],"sourcesContent":["(ns main.core\n  (:require\n    [reagent.core :as r]\n    [reagent.dom :as rdom]\n    [clojure.string :as str]))\n\n(defonce state\n  (r/atom\n    {:arc [{:x 65, :y 130.5625, :highlighted? false}\n           {:x 226, :y 321.5625, :highlighted? false}\n           {:x 682, :y 63.5625, :highlighted? false}\n           {:x 844, :y 245.5625, :highlighted? false}]\n     :ctx nil}))\n\n(def point-r 5)\n\n;; :on-change #(reset! time-color (-> % .-target .-value))}]])\n\n(defn draw-point [ctx {:keys [x y highlighted?]}]\n  (doto ctx\n    (.beginPath)\n    (-> (.-strokeStyle) (set! (if highlighted? \"rgb(241 102 102)\" \"#ccc\")))\n    (-> (.-lineWidth) (set! 2))\n    (.arc x y point-r 0 (* 2 js/Math.PI) false)\n    (-> (.-fillStyle) (set! \"#eee\"))\n    (.fill)\n    (.stroke)))\n\n(defn draw-canvas []\n  (let [{:keys [arc ctx]} @state\n        [start control1 control2 end] arc]\n    (when ctx\n      (doto ctx\n        (.clearRect 0 0 (.-width (.-canvas ctx)) (.-height (.-canvas ctx)))\n        (-> (.-strokeStyle) (set! \"#222\"))\n        (-> (.-lineWidth) (set! 3))\n        (.beginPath)\n        (.moveTo (:x start) (:y start))\n        (.bezierCurveTo (:x control1) (:y control1)\n                        (:x control2) (:y control2)\n                        (:x end) (:y end))\n        (.stroke)\n        (-> (.-strokeStyle) (set! \"#ccc\"))\n        (-> (.-lineWidth) (set! 1))\n        (.beginPath)\n        (.moveTo (:x start) (:y start))\n        (.lineTo (:x control1) (:y control1))\n        (.stroke)\n        (.beginPath)\n        (.moveTo (:x end) (:y end))\n        (.lineTo (:x control2) (:y control2))\n        (.stroke)\n        (draw-point control1)\n        (draw-point control2)\n        (draw-point start)\n        (draw-point end)))\n    nil))\n\n(defn main-view []\n  [:div {:style {:width :900px}}\n   [:div {:style {:border-bottom \"5px solid #222\"\n                  :margin-bottom :10px}}\n    [:h1 {:style {:color :#222\n                  :margin-bottom :5px}}\n     \"Arcs\"]]\n   [draw-canvas]\n   ;; [:p {:style {:color \"#777\"}}\n   ;;  (pr-str (map #(select-keys % [:x :y]) (:arc @state)))]\n   ])\n\n(defn ->xy [canvas-rect event]\n  (let [x (- (.-clientX event) (.-left canvas-rect))\n        y (- (.-clientY event) (.-top canvas-rect))]\n    [x y]))\n\n(defn in-vicinity? [v]\n  (<= (js/Math.abs v) point-r))\n\n(defn on-mousedown [canvas-rect event]\n  (let [[x y] (->xy canvas-rect event)\n        {point-path :path hit :hit}\n        (reduce\n          (fn [{:keys [path]} point]\n            (if (and (in-vicinity? (- x (:x point)))\n                     (in-vicinity? (- y (:y point))))\n              (reduced {:path path :hit true})\n              {:path (inc path)}))\n          {:path 0}\n          (:arc @state))]\n    (prn :x x :y y)\n    (when hit\n      (swap! state assoc-in [:arc point-path] {:x x :y y :highlighted? true})\n      (swap! state assoc :dragging-path point-path))))\n\n(defn on-mousemove [canvas-rect event]\n  (when-let [path (:dragging-path @state)]\n    (let [[x y] (->xy canvas-rect event)]\n      (swap! state assoc-in [:arc path] {:x x :y y :highlighted? true}))))\n\n(defn on-mouseup [canvas-rect event]\n  (when-let [path (:dragging-path @state)]\n    (swap! state assoc-in [:arc path :highlighted?] false)\n    (swap! state dissoc :dragging-path)))\n\n(defn setup-canvas []\n  (let [canvas-element (js/document.getElementById \"canvas\")\n        dpr (or js/window.devicePixelRatio 1)\n        canvas-rect (.getBoundingClientRect canvas-element)]\n    (set! (.-width canvas-element) (* dpr (.-width canvas-rect)))\n    (set! (.-height canvas-element) (* dpr (.-height canvas-rect)))\n\n    (.addEventListener canvas-element \"mousedown\" (partial on-mousedown canvas-rect))\n    (.addEventListener canvas-element \"mousemove\" (partial on-mousemove canvas-rect))\n    (.addEventListener canvas-element \"mouseup\" (partial on-mouseup canvas-rect))\n\n    (swap! state assoc :ctx (.getContext canvas-element \"2d\"))))\n\n(defn ^:dev/after-load start []\n  (rdom/render [main-view] (js/document.getElementById \"root\"))\n  (when-not (:ctx @state)\n    (setup-canvas)))\n\n(defn ^:export run []\n  (start))\n\n(run)\n"]}